{"version":3,"file":"pgn-data.js","sourceRoot":"","sources":["../../../graphics/pgn/pgn-data.ts"],"names":[],"mappings":"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","sourcesContent":["import { VariationMove } from \"./index.js\";\n\n// PGN headers contains all relevant information pertaining to the SAN of some game. This class\n// handles the proper text (based on given and missing information) that describes the PGN headers.\n\n// determines all valid headers and their default order\n// \"as const\" is necessary because it prevents TypeScript from seeing this as a\n// string[] type (\"widening\")\nexport const VALID_HEADERS = [ \"Event\", \"Site\", \"Round\", \"TimeControl\", \"White\", \"Black\", \"Result\", \"Termination\", \"Variant\", \"FEN\" ] as const;\nexport type PGNHeader = typeof VALID_HEADERS[number];\nexport type PGNHeaders = { [key in PGNHeader]?: string };\n\nexport class PGNData {\n    // whether or not started as white to play\n    public startedWTP: boolean = true;\n    public headers: PGNHeaders = {};\n\n    constructor(public pgnRoot: VariationMove){\n        this.initHeaders();\n    }\n\n    private initHeaders(): void {\n        this.headers = {\n            \"Event\": \"Hyper Chess Analysis\",\n            \"Site\": window.location.href,\n            \"Result\": \"*\",\n            \"Variant\": \"Standard\"\n        };\n    }\n\n    public clearHeaders(): void {\n        this.headers = {};\n    }\n\n    public clear(): void {\n        this.initHeaders();\n    }\n\n    public setHeader(hdr: PGNHeader, value: string): void {\n        this.headers[hdr] = value;\n\n        if (hdr == \"FEN\"){\n            this.startedWTP = value.split(\" \")[1] == \"w\";\n        }else if (hdr == \"Variant\" && value == \"Standard\"){\n            this.startedWTP = true;\n        }\n    }\n\n    public unsetHeader(hdr: PGNHeader): void {\n        delete this.headers[hdr];\n    }\n\n    public toString(): string {\n        let pgn = \"\";\n        // show all valid headers\n        for (const hdr of VALID_HEADERS){\n            if (this.headers[hdr])\n                pgn += `[${hdr} \"${this.headers[hdr]}\"]\\n`;\n        }\n        pgn += `\\n${this.san}`;\n        return pgn;\n    }\n\n    // generates SAN for this descendant node\n    public sanHelper(node: VariationMove | undefined, count: number): string {\n        let san = \"\";\n        let iter: VariationMove | undefined = node;\n\n        if (!this.startedWTP && node && node == this.pgnRoot.next[0])\n            count++;\n\n        // add full move counter\n        if (count % 2 != 0){\n            san += `${Math.floor(count / 2) + 1}... `;\n        }\n\n        // just prevent crashing :)\n        let maxIters = 9999;\n\n        // loop through pgn moves\n        while (iter && --maxIters){\n            // fullmove\n            if (count % 2 == 0)\n                san += `${Math.floor(count / 2) + 1}. `;\n\n            san += `${iter.san} `;\n\n            count++;\n\n            // go through each variation and add it as a variation (enclosed in parentheses)\n            if (iter.next.length > 1){\n                \n                // fullmove\n                if (count % 2 == 0)\n                    san += `${Math.floor(count / 2) + 1}. `;\n\n                san += `${iter.next[0]!.san} `;\n                count++;\n\n                for (let i = 1; i < iter.next.length; i++){\n                    san += `( ${this.sanHelper(iter.next[i]!, count - 1)}) `;\n                }\n\n                iter = iter.next[0];\n            }\n            if (iter)\n                iter = iter.next[0];\n        }\n\n        return san;\n    }\n\n    get san(){\n        return this.sanHelper(this.pgnRoot.next[0], 0);\n    }\n}\n"]}