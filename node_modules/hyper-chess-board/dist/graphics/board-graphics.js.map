{"version":3,"file":"board-graphics.js","sourceRoot":"","sources":["../../graphics/board-graphics.ts"],"names":[],"mappings":"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","sourcesContent":["import { VariationsBoard } from \"../game/variations-board.js\";\nimport { setInputTarget } from \"./input.js\";\nimport { BoardWidget, getFirstElemOfClass, getWidgetLocName, WidgetLocation } from \"./widgets/board-widget.js\";\nimport {\n    setAllPiecesToPool, setAllMoveHighlightsToPool, setAllLastMoveHighlightsToPool,\n    getPieceFromPool, getLastMoveHighlightFromPool, attachGlyph\n} from \"./pool.js\";\nimport { getPieceSide, getPieceType, Move, Side } from \"../index.js\";\nimport { VariationMove } from \"./pgn/variation.js\";\n\n// BoardGraphics has been created to handle the instantiation of a graphical board. The bare minimum\n// that it allows is a board element with pieces displayed on it, but it can support any combination\n// of widgets, that may listen to relevant state changes.\n\nexport class BoardGraphics extends VariationsBoard {\n    public skeleton: HTMLElement;\n    public boardDiv: HTMLElement;\n    public piecesDiv: HTMLElement;\n    public draggingElem: HTMLElement;\n\n    private widgets: { [name: string]: BoardWidget };\n    private widgetNames: Set<string> = new Set<string>();\n\n    private allowInputFrom: { [side: number]: boolean };\n    private allowVariations: boolean = true;\n    private piecePointerDown: (event: PointerEvent) => void;\n\n    public graphicalVariation: VariationMove;\n\n    constructor(allowDragging = true, displayRanksAndFiles = false, skeleton = null){\n        super();\n        this.skeleton = createSkeleton(skeleton);\n        this.skeleton.classList.add(\"board-graphics--board-blue\", \"board-graphics--pieces-cburnett\");\n\n        const boardDiv = this.skeleton.getElementsByClassName(\"board-graphics__board\")[0] as HTMLElement;\n        if (!boardDiv)\n            throw new Error(\"Skeleton requires a unique empty div of class name board-graphics__board\");\n        \n        const piecesDiv = document.createElement(\"div\");\n        piecesDiv.classList.add(\"board-graphics__pieces\");\n        boardDiv.appendChild(piecesDiv);\n\n        // set attributes\n        this.widgets = {};\n        this.boardDiv = boardDiv;\n        this.piecesDiv = piecesDiv;\n        this.allowInputFrom = { [Side.White]: allowDragging, [Side.Black]: allowDragging };\n        this.allowVariations = true;\n        this.piecePointerDown = createPiecePointerDown(this);\n\n        // graphicalVariation points to the variation currently displayed to the user. If\n        // currentVariation does not match with graphicalVariation, applyChanges should be called.\n        this.graphicalVariation = this.currentVariation;\n\n        // determine if meant to create files and ranks.\n        if (displayRanksAndFiles)\n            addFilesAndRanks(boardDiv);\n\n        this.draggingElem = createBoardDraggingElem(this.skeleton);\n        if (allowDragging)\n            boardDiv.onpointerdown = this.piecePointerDown;\n    }\n\n    public get isFlipped(): boolean {\n        return this.skeleton.classList.contains(\"board-graphics--flipped\");\n    }\n\n    public loading(): void {\n        this.skeleton.classList.add(\"board-graphics--loading\");\n    }\n\n    public finishedLoading(): void {\n        this.skeleton.classList.remove(\"board-graphics--loading\");\n    }\n\n    // retrieves the relevant widget container, creating one if necessary\n    public getWidgetContainer(location: WidgetLocation): HTMLElement {\n        const widgetLocName = getWidgetLocName(location);\n        const elem = getFirstElemOfClass(this.skeleton, `board-graphics__${widgetLocName}`) as HTMLElement;\n        if (elem)\n            return elem;\n        \n        const w = document.createElement(\"div\");\n        w.classList.add(`board-graphics__${widgetLocName}`);\n        this.skeleton.appendChild(w);\n        return w;\n    }\n\n    // expects widgets to be a set of widget names.\n    public setActiveWidgets(widgets: Set<string>): void {\n        console.log(Array.from(widgets));\n        for (const [ name, widget ] of Object.entries(this.widgets)){\n            if (widgets.has(name)){\n                widget.enable();\n                widgets.delete(name);\n            }else\n                widget.disable();\n        }\n        console.log(Array.from(widgets));\n    }\n\n    public attachWidget(widget: BoardWidget): void {\n        const name = widget.constructor.name;\n        if (this.widgetNames.has(name)){\n            console.error(\"Attempted to attach \", name, \" as a widget to \", this, \" when an instance of this widget is already attached.\");\n            throw new Error(\"Tried to attach a widget of the same name to a BoardGraphics instance.\");\n        }\n        this.widgetNames.add(name);\n        this.widgets[name] = widget;\n    }\n\n    public setNames(whiteName: string, blackName: string): void {\n        this.dispatchEvent(\"player-names\", { whiteName, blackName });\n    }\n\n    // =========================== //\n    // === LOADING FEN AND PGN === //\n    // =========================== //\n\n    public override loadFEN(fen: string): void {\n        super.loadFEN(fen);\n\n        this.graphicalVariation = this.variationRoot;\n        this.applyChanges(false);\n        this.dispatchEvent(\"loadFEN\", { fen });\n    }\n\n    public override loadPGN(pgn: string): void {\n        super.loadPGN(pgn);\n\n        const w = this.pgnData.headers.White;\n        const b = this.pgnData.headers.Black;\n        if (w && b)\n            this.setNames(w, b);\n\n        this.applyChanges(false);\n    }\n\n    // =========================== //\n    // === HANDLING VARIATIONS === //\n    // =========================== //\n\n    public applyChanges(userInput = false): void {\n        this.display();\n\n        const cv = this.currentVariation;\n        const gv = this.graphicalVariation;\n\n        // no variation changes!\n        if (cv == gv)\n            return;\n        \n        // check if one of the variations follows the other\n        if (cv.prev == gv || gv.prev == cv)\n            this.dispatchEvent(\"single-scroll\", { prevVariation: gv, variation: cv, userInput });\n        \n        this.graphicalVariation = this.currentVariation;\n\n        this.dispatchEvent(\"variation-change\", { variation: cv });\n\n        // apply any relevant glyphs\n        if (cv.move){\n            const toX = cv.move.to % 8;\n            const toY = Math.floor(cv.move.to / 8);\n            \n            // attach any relevant glyphs\n            for (const g of cv.glyphs){\n                const pieceElem = this.getPieceElem(toX, toY);\n                if (pieceElem)\n                    attachGlyph(pieceElem, g);\n            }\n        }\n\n        // check and dispatch event for any results\n        const result = this.isGameOver();\n        if (result){\n            this.dispatchEvent(\"result\", {\n                turn:           this.turn,\n                termination:    result.termination,\n                winner:         result.winner\n            });\n        }\n    }\n\n    public override deleteVariation(variation: VariationMove, isHelper = false): void {\n        super.deleteVariation(variation, isHelper);\n        this.dispatchEvent(\"delete-variation\", { variation });\n        this.applyChanges(false);\n    }\n\n    // ========================== //\n    // === HANDLING MAKE MOVE === //\n    // ========================== //\n\n    public override playMove(move: Move): VariationMove | undefined {\n        const variation = super.playMove(move);\n        if (variation)\n            this.dispatchEvent(\"new-variation\", { variation });\n        return variation;\n    }\n\n    // returns true if the player can move the piece at the given square. Otherwise, returns false.\n    public canMove(sq: number): boolean {\n        // ensure user is not creating a variation when not allowed to.\n        if (!this.allowVariations && this.currentVariation.next.length > 0)\n            return false;\n\n        // prevent user from playing when a result is already set\n        if (this.isGameOver())\n            return false;\n\n        const piece = this.getPiece(sq);\n        const side = getPieceSide(piece);\n        return this.allowInputFrom[side]! && !this.isImmobilized(sq, piece) && this.turn == side;\n    }\n\n    // ============================== //\n    // === HANDLING BOARD DISPLAY === //\n    // ============================== //\n\n    // if v is false: white perspective\n    // if v is true: black perspective\n    public setFlip(v: boolean): void {\n        if (v != this.isFlipped)\n            this.flip();\n    }\n\n    // flips the board and then redisplays it\n    public flip(): void {\n        this.skeleton.classList.toggle(\"board-graphics--flipped\");\n        this.display();\n        this.dispatchEvent(\"flip\", {});\n    }\n\n    public display(): void {\n        setAllPiecesToPool(this.skeleton);\n        setAllMoveHighlightsToPool(this.skeleton);\n        setAllLastMoveHighlightsToPool(this.skeleton);\n\n        const lastMove = this.currentVariation != this.variationRoot ? this.currentVariation.move : undefined;\n\n        // highlight move from and move to\n        if (lastMove){\n            const toX = lastMove.to % 8;\n            const toY = Math.floor(lastMove.to / 8);\n            const fromX = lastMove.from % 8;\n            const fromY = Math.floor(lastMove.from / 8);\n            \n            const sq1 = getLastMoveHighlightFromPool(toX, toY, this.isFlipped);\n            const sq2 = getLastMoveHighlightFromPool(fromX, fromY, this.isFlipped);\n            this.piecesDiv.appendChild(sq1);\n            this.piecesDiv.appendChild(sq2);\n        }\n\n        // display all pieces on the board\n        for (let r = 0; r < 8; r++){\n            for (let f = 0; f < 8; f++){\n                const v = this.getPiece(r * 8 + f);\n                if (v){\n                    const piece = getPieceFromPool(f, r, this.isFlipped, getPieceType(v), getPieceSide(v));\n                    this.piecesDiv.appendChild(piece);\n                }\n            }\n        }\n    }\n\n    public getPieceElem(f: number, r: number): HTMLElement | undefined {\n        return this.piecesDiv.getElementsByClassName(`${f}_${r}`)[0] as (HTMLElement | undefined);\n    }\n\n    private dispatchEvent(name: string, detail: any): void {\n        this.skeleton.dispatchEvent(new CustomEvent(name, { detail }));\n    }\n}\n\n\n// external helper functions that are separated to avoid clutter in the constructor.\n// they are generally used to populate the skeleton with graphical features.\n\n// creates a graphical skeleton that is meant to contain a chess board's graphics and widgets.\nfunction createSkeleton(skeleton: HTMLElement | null): HTMLElement {\n    // skeleton contains all widgets including main board display\n    if (!skeleton)\n        skeleton = document.createElement(\"div\");\n\n    skeleton.classList.add(\"board-graphics\");\n\n    skeleton.innerHTML = `<div class = \"board-graphics__board\">\n    <div class = \"board-graphics__loading\">\n        <img class = \"board-graphics__loading-img\" src = \"./images/pieces/immobilizer.png\">\n    </div>\n</div>`;\n\n    if (!skeleton.hasAttribute(\"tabindex\"))\n        skeleton.setAttribute(\"tabindex\", \"-1\");\n\n    return skeleton;\n}\n\nfunction addFilesAndRanks(boardDiv: HTMLElement): void {\n    const filesDiv = document.createElement(\"div\");\n    filesDiv.classList.add(\"board-graphics__files\");\n    for (const c of \"abcdefgh\"){\n        const file = document.createElement(\"div\");\n        file.innerText = c;\n        filesDiv.appendChild(file);\n    }\n    boardDiv.appendChild(filesDiv);\n\n    const ranksDiv = document.createElement(\"div\");\n    ranksDiv.classList.add(\"board-graphics__ranks\");\n    for (let r = 1; r <= 8; r++){\n        const rank = document.createElement(\"div\");\n        rank.innerText = r.toString();\n        ranksDiv.appendChild(rank);\n    }\n    boardDiv.appendChild(ranksDiv);\n}\n\nfunction createBoardDraggingElem(skeleton: HTMLElement): HTMLElement {\n    const drag = document.createElement(\"div\");\n    drag.classList.add(\"board-graphics__dragging\");\n    skeleton.appendChild(drag);\n    return drag;\n}\n\nfunction createPiecePointerDown(gameState: BoardGraphics): (event: PointerEvent) => void {\n    return (event: PointerEvent): void => {\n        setInputTarget(gameState, gameState.draggingElem, event);\n    };\n}\n"]}