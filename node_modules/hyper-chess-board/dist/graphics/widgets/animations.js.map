{"version":3,"file":"animations.js","sourceRoot":"","sources":["../../../graphics/widgets/animations.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,EAAE,aAAa,EAAE,MAAM,sBAAsB,CAAC;AACpE,OAAO,EAAE,WAAW,EAAE,MAAM,mBAAmB,CAAC;AAChD,OAAO,EAAE,gBAAgB,EAAE,eAAe,EAAE,MAAM,YAAY,CAAC;AAE/D,OAAO,EAAE,YAAY,EAAE,YAAY,EAAE,MAAM,qBAAqB,CAAC;AAEjE,0BAA0B;AAE1B,MAAM,OAAO,eAAgB,SAAQ,WAAW;IACpC,gBAAgB,GAAoC,EAAE,CAAC;IAE/D,YAAY,QAAuB;QAC/B,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChB,QAAQ,CAAC,QAAQ,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC,KAAK,EAAE,EAAE;YAC1D,IAAI,CAAC,YAAY,CAAC,KAAoB,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;IACP,CAAC;IAED,YAAY,CAAC,KAAkB;QAC3B,MAAM,EAAE,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC;QAE7D,IAAI,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;QAExC,0BAA0B;QAC1B,KAAK,MAAM,CAAC,IAAI,IAAI,CAAC,gBAAgB;YACjC,YAAY,CAAC,CAAC,CAAC,CAAC;QACpB,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;QAE3B,IAAI,SAAS;YACT,OAAO;QAEX,wDAAwD;QACxD,MAAM,GAAG,GAAG,SAAS,CAAC,IAAI,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACrD,IAAI,YAAY,GAAG,SAAS,CAAC,IAAI,CAAC;QAClC,IAAI,GAAG,IAAI,CAAC,CAAC;YACT,YAAY,GAAG,aAAa,CAAC,IAAI,CAAC;QAEtC,IAAI,CAAC,YAAY;YACb,OAAO;QAEX,iCAAiC;QACjC,KAAK,MAAM,CAAC,IAAI,YAAY,CAAC,QAAQ,EAAC,CAAC;YACnC,MAAM,KAAK,GAAG,gBAAgB,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,SAAS,EAAE,YAAY,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACxI,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,iCAAiC,CAAC,CAAC;YACvD,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC/C,CAAC;QAED,6BAA6B;QAC7B,IAAI,KAA8B,CAAC;QAEnC,IAAI,GAAG,IAAI,CAAC,EAAC,CAAC;YACV,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,CAAE,CAAC;YACpG,eAAe,CAAC,KAAK,EAAE,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,SAAS,CAAC,CAAC;QAC1G,CAAC;aAAI,CAAC;YACF,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,CAAE,CAAC;YACxG,eAAe,CAAC,KAAK,EAAE,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC;QACtG,CAAC;QAED,IAAI,EAAE,GAAgD,IAAI,CAAC,gBAAgB,CAAC;QAC5E,MAAM,OAAO,GAAG,UAAU,CAAC,GAAG,EAAE;YAC5B,IAAI,GAAG,IAAI,CAAC;gBACR,eAAe,CAAC,KAAM,EAAE,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC;;gBAEnG,eAAe,CAAC,KAAM,EAAE,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,SAAS,CAAC,CAAC;YAE3G,IAAI,EAAE,EAAC,CAAC;gBACJ,MAAM,KAAK,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;gBAClC,IAAI,KAAK,GAAG,CAAC,CAAC;oBACV,EAAE,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC;YAED,EAAE,GAAG,SAAS,CAAC;YACf,KAAK,GAAG,SAAS,CAAC;QACtB,CAAC,EAAE,EAAE,CAAC,CAAC;QAEP,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC;CACJ","sourcesContent":["import { getFileFromSq, getRankFromSq } from \"../../game/coords.js\";\nimport { BoardWidget } from \"./board-widget.js\";\nimport { getPieceFromPool, setElemLocation } from \"../pool.js\";\nimport type { BoardGraphics } from \"../board-graphics.js\";\nimport { getPieceSide, getPieceType } from \"../../game/piece.js\";\n\n// handles move animations\n\nexport class AnimationWidget extends BoardWidget {\n    private queuedAnimations: ReturnType<typeof setTimeout>[] = [];\n\n    constructor(boardgfx: BoardGraphics){\n        super(boardgfx);\n        boardgfx.skeleton.addEventListener(\"single-scroll\", (event) => {\n            this.singleScroll(event as CustomEvent);\n        });\n    }\n\n    singleScroll(event: CustomEvent){\n        const { prevVariation, variation, userInput } = event.detail;\n\n        let isFlipped = this.boardgfx.isFlipped;\n\n        // clear queued animations\n        for (const a of this.queuedAnimations)\n            clearTimeout(a);\n        this.queuedAnimations = [];\n\n        if (userInput)\n            return;\n\n        // display the board from just before the move was made.\n        const dir = variation.prev == prevVariation ? 1 : -1;\n        let lastMadeMove = variation.move;\n        if (dir == -1)\n            lastMadeMove = prevVariation.move;\n\n        if (!lastMadeMove)\n            return;\n\n        // make captured pieces disappear\n        for (const c of lastMadeMove.captures){\n            const piece = getPieceFromPool(getFileFromSq(c.sq), getRankFromSq(c.sq), isFlipped, getPieceType(c.captured), getPieceSide(c.captured));\n            piece.classList.add(\"board-graphics__piece--captured\");\n            this.boardgfx.piecesDiv.appendChild(piece);\n        }\n\n        // now move piece graphically\n        let piece: HTMLElement | undefined;\n\n        if (dir == 1){\n            piece = this.boardgfx.getPieceElem(getFileFromSq(lastMadeMove.to), getRankFromSq(lastMadeMove.to))!;\n            setElemLocation(piece, getFileFromSq(lastMadeMove.from), getRankFromSq(lastMadeMove.from), isFlipped);\n        }else{\n            piece = this.boardgfx.getPieceElem(getFileFromSq(lastMadeMove.from), getRankFromSq(lastMadeMove.from))!;\n            setElemLocation(piece, getFileFromSq(lastMadeMove.to), getRankFromSq(lastMadeMove.to), isFlipped);\n        }\n\n        let qa: ReturnType<typeof setTimeout>[] | undefined = this.queuedAnimations;\n        const timeout = setTimeout(() => {\n            if (dir == 1)\n                setElemLocation(piece!, getFileFromSq(lastMadeMove.to), getRankFromSq(lastMadeMove.to), isFlipped);\n            else\n                setElemLocation(piece!, getFileFromSq(lastMadeMove.from), getRankFromSq(lastMadeMove.from), isFlipped);\n\n            if (qa){\n                const index = qa.indexOf(timeout);\n                if (index > -1)\n                    qa.splice(index, 1);\n            }\n\n            qa = undefined;\n            piece = undefined;\n        }, 10);\n\n        this.queuedAnimations.push(timeout);\n    }\n}\n"]}