{"version":3,"file":"audio-widget.js","sourceRoot":"","sources":["../../../graphics/widgets/audio-widget.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,WAAW,EAAE,MAAM,mBAAmB,CAAC;AAEhD,4EAA4E;AAE5E,MAAM,KAAK,GAAG;IACV,IAAI,EAAY,iBAAiB;IACjC,OAAO,EAAS,oBAAoB;CACvC,CAAC;AAEF,sCAAsC;AACtC,kGAAkG;AAClG,oEAAoE;AACpE,MAAM,aAAa,GAAG;IAClB,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC;IACnC,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,IAAI,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC;CAC5C,CAAC;AAEF,MAAM,OAAO,WAAY,SAAQ,WAAW;IACxC,YAAY,QAAuB;QAC/B,KAAK,CAAC,QAAQ,CAAC,CAAC;QAEhB,QAAQ,CAAC,QAAQ,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC,KAAK,EAAE,EAAE;YAC1D,MAAM,EAAE,SAAS,EAAE,GAAI,KAAqB,CAAC,MAAM,CAAC;YAEpD,kEAAkE;YAClE,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAC9B,CAAC,CAAC,CAAC;IACP,CAAC;CACJ;AAED,SAAS,SAAS,CAAC,GAAW;IAC1B,IAAI,aAAa,CAAC,GAAG,CAAC,EAAC,CAAC;QACpB,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;QAC1B,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;IAC9B,CAAC;SAAI,CAAC;QACF,CAAC,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IAC5B,CAAC;IAED,aAAa,CAAC,GAAG,CAAC,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;IACpC,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;AAC9B,CAAC;AAED,SAAS,SAAS,CAAC,IAAU;IACzB,IAAI,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC;QAChC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;;QAEzB,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AAC9B,CAAC","sourcesContent":["import type { Move } from \"../../game/move.js\";\nimport type { BoardGraphics } from \"../board-graphics.js\";\nimport { BoardWidget } from \"./board-widget.js\";\n\n// Whenever a move, capture, or something important happens, a sound occurs.\n\nconst AUDIO = {\n    move:           \"sounds/move.mp3\",\n    capture:        \"sounds/capture.mp3\"\n};\n\n// this is a certified goofy solution.\n// audio is \"buffered\" because of a delay when the request for the audio is issued. This acts as a\n// cache. Even though the browser automatically caches audio...? eh.\nconst bufferedAudio = {\n    [AUDIO.move]: new Audio(AUDIO.move),\n    [AUDIO.capture]: new Audio(AUDIO.capture)\n};\n\nexport class AudioWidget extends BoardWidget {\n    constructor(boardgfx: BoardGraphics){\n        super(boardgfx);\n\n        boardgfx.skeleton.addEventListener(\"single-scroll\", (event) => {\n            const { variation } = (event as CustomEvent).detail;\n            \n            // only play audio if move scrolling is going forward by exactly 1\n            makeNoise(variation.move);\n        });\n    }\n}\n\nfunction playAudio(src: string): void {\n    if (bufferedAudio[src]){\n        bufferedAudio[src].load();\n        bufferedAudio[src].play();\n    }else{\n        (new Audio(src)).play();\n    }\n\n    bufferedAudio[src] = new Audio(src);\n    bufferedAudio[src].load();\n}\n\nfunction makeNoise(move: Move): void {\n    if (move && move.captures.length > 0)\n        playAudio(AUDIO.capture);\n    else\n        playAudio(AUDIO.move);\n}\n"]}