{"version":3,"file":"protocol.js","sourceRoot":"","sources":["../../../engine/abstract/protocol.ts"],"names":[],"mappings":"AAKA,MAAM,OAAgB,WAAW;IACnB,GAAG,CAAa;IAChB,UAAU,GAAoC,EAAE,CAAC;IACjD,SAAS,GAAW,CAAC,CAAC,CAAC;IAEzB,yBAAyB,GAA+B,EAAE,CAAC;IAE3D,UAAU,GAAW,KAAK,CAAC;IAC3B,UAAU,GAAW,KAAK,CAAC;IAEnC,YAAY,UAAsB;QAC9B,IAAI,CAAC,GAAG,GAAG,UAAU,CAAC;QACtB,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;IACrB,CAAC;IAES,aAAa,CAAC,IAAY;QAChC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IAC3B,CAAC;IAES,aAAa,CAAC,IAAY;QAChC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IAC3B,CAAC;IAEM,aAAa;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IAEM,aAAa;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IAEM,2BAA2B,CAAC,QAAkC;QACjE,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAClD,CAAC;IAES,gBAAgB,CAAC,KAAiB;QACxC,IAAI,KAAK,CAAC,KAAK;YACX,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC;QACjC,MAAM,SAAS,GAA2B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC1E,IAAI,SAAS,EAAC,CAAC;YACX,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;QACpC,CAAC;aAAI,CAAC;YACF,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC;QAC5C,CAAC;QACD,KAAK,MAAM,CAAC,IAAI,IAAI,CAAC,yBAAyB;YAC1C,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAE,CAAC,CAAC;IAC5C,CAAC;IAEM,aAAa;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;IACjD,CAAC;IAEM,eAAe;QAClB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;IACzB,CAAC;CAUJ","sourcesContent":["import type { GameTime, ThinkStats } from \"../utils.js\";\nimport type { BotProcess } from \"./bot-process.js\";\n\ntype ThinkStatsUpdateListener = (stats: ThinkStats) => any;\n\nexport abstract class BotProtocol {\n    protected bot: BotProcess;\n    protected thinkStats: { [depth: number]: ThinkStats } = {};\n    protected currDepth: number = -1;\n\n    private thinkStatsUpdateListeners: ThinkStatsUpdateListener[] = [];\n\n    private engineName: string = \"???\";\n    private authorName: string = \"???\";\n\n    constructor(botProcess: BotProcess){\n        this.bot = botProcess;\n        this.bot.start();\n    }\n\n    protected setEngineName(name: string): void {\n        this.engineName = name;\n    }\n\n    protected setAuthorName(name: string): void {\n        this.authorName = name;\n    }\n\n    public getEngineName(): string {\n        return this.engineName;\n    }\n\n    public getAuthorName(): string {\n        return this.authorName;\n    }\n\n    public addThinkStatsUpdateListener(listener: ThinkStatsUpdateListener){\n        this.thinkStatsUpdateListeners.push(listener);\n    }\n\n    protected updateThinkStats(stats: ThinkStats){\n        if (stats.depth)\n            this.currDepth = stats.depth;\n        const currStats: ThinkStats | undefined = this.thinkStats[this.currDepth];\n        if (currStats){\n            Object.assign(currStats, stats);\n        }else{\n            this.thinkStats[this.currDepth] = stats;\n        }\n        for (const l of this.thinkStatsUpdateListeners)\n            l(this.thinkStats[this.currDepth]!);\n    }\n\n    public getThinkStats(): ThinkStats {\n        return this.thinkStats[this.currDepth] || {};\n    }\n\n    public resetThinkStats(){\n        this.thinkStats = {};\n    }\n\n    public abstract setFEN(fen: string): void;\n    public abstract playMove(lan: string): void;\n    public abstract thinkForMoveTime(ms: number, allowTimeout: boolean, timeoutPaddingMs: number): Promise<string | undefined>;\n    public abstract thinkTimedGame(time: GameTime, allowTimeout: boolean, isWhite: boolean, timeoutPaddingMs: number): Promise<string | undefined>;\n    public abstract thinkForDepth(depth: number): Promise<string | undefined>;\n    public abstract startThink(): void;\n    public abstract stopThink(): void;\n    public abstract isReady(timeoutMs: number): Promise<boolean>;\n}\n"]}