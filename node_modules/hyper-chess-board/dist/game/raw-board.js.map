{"version":3,"file":"raw-board.js","sourceRoot":"","sources":["../../game/raw-board.ts"],"names":[],"mappings":"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","sourcesContent":["import { squareToAlgebraic } from \"./coords.js\";\nimport { PieceType, Side, isPieceOfSide, getPieceType, isPieceOfType, getPieceSide, Piece, getFENCharFromPieceType, getPieceFromFENChar, arePiecesSameSide } from \"./piece.js\";\nimport { numSquaresToEdge, dirOffsets } from \"./pre-game.js\";\n\n// the base board with no move-gen functionality. The only reason this class\n// exists is to separate the move generator from generic board operations, such\n// as checking where pieces are.\n\nexport class RawBoard {\n    // contains the type and side of every piece on all 64 squares (Side | PieceType)\n    private squares = new Uint8Array(64);\n    private pieceCounts: number[][] = [ [ 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0 ] ];\n    protected turn: Side = Side.White;\n\n    // quick look-ups for piece squares (first index is white second is black)\n    protected kings = new Uint8Array(2);\n    protected coordinators = new Uint8Array(2);\n    protected chameleons = new Uint8Array(4);\n\n    protected fullmove: number = 1;\n    // keeps track of the history of halfmoves (to allow for undoing moves)\n    protected halfmoves: number[] = [];\n\n    constructor(){}\n\n    public getFullMove(): number {\n        return this.fullmove;\n    }\n\n    public getTurn(): Side {\n        return this.turn;\n    }\n\n    public getPieceCount(p: Piece): number {\n        return this.pieceCounts[isPieceOfSide(p, Side.White) ? 0 : 1]![getPieceType(p)]!;\n    }\n\n    public getPiece(sq: number): Piece {\n        return this.squares[sq]!;\n    }\n\n    // picks up the piece at the sq\n    // returns the value of the picked up piece\n    public pickup(sq: number): Piece {\n        const val = this.getPiece(sq);\n\n        if (val == 0)\n            return 0;\n\n        this.squares[sq] = 0;\n\n        const isWhite = isPieceOfSide(val, Side.White);\n        this.pieceCounts[isWhite ? 0 : 1]![getPieceType(val)]!--;\n\n        // update piece square look ups\n        if (isPieceOfType(val, PieceType.Coordinator)){\n            // remove coordinator from list\n            this.coordinators[getPieceSide(val) / 8 - 1] = 255;\n        }else if (isPieceOfType(val, PieceType.Chameleon)){\n            // remove chameleon from list\n            if (isWhite){\n                if (this.chameleons[0] == sq){\n                    this.chameleons[0] = this.chameleons[1]!;\n                    this.chameleons[1] = 255;\n                }else if (this.chameleons[1] == sq)\n                    this.chameleons[1] = 255;\n                else{\n                    console.log(\"white\", this.getFEN(), this.chameleons);\n                    throw new Error(`Tried to pick up a chameleon on ${squareToAlgebraic(sq)} but it was never stored in the lookup`);\n                }\n            }else{\n                if (this.chameleons[2] == sq){\n                    this.chameleons[2] = this.chameleons[3]!;\n                    this.chameleons[3] = 255;\n                }else if (this.chameleons[3] == sq)\n                    this.chameleons[3] = 255;\n                else{\n                    console.log(\"black\", this.getFEN(), this.chameleons);\n                    throw new Error(`Tried to pick up a chameleon on ${squareToAlgebraic(sq)} but it was never stored in the lookup`);\n                }\n            }\n        }else if (isPieceOfType(val, PieceType.King)){\n            if (isWhite){\n                this.kings[0] = 255;\n            }else{\n                this.kings[1] = 255;\n            }\n        }\n\n        return val;\n    }\n\n    // places down the given piece at the sq\n    // assumes that there is currently no piece at the given sq.\n    public placedown(sq: number, piece: Piece): void {\n        if (this.squares[sq])\n            return;\n\n        this.squares[sq] = piece;\n\n        const isWhite = isPieceOfSide(piece, Side.White);\n        this.pieceCounts[isWhite ? 0 : 1]![getPieceType(piece)]!++;\n\n        // update piece square look ups\n        if (isPieceOfType(piece, PieceType.Coordinator)){\n            const idx = getPieceSide(piece) / 8 - 1;\n            if (this.coordinators[idx] == 255)\n                this.coordinators[idx] = sq;\n            else\n                throw new Error(\"Cannot have more than 1 coordinator on one side in a position\");\n        }else if (isPieceOfType(piece, PieceType.Chameleon)){\n            if (isWhite){\n                if (this.chameleons[0] == 255)\n                    this.chameleons[0] = sq;\n                else if (this.chameleons[1] == 255)\n                    this.chameleons[1] = sq;\n                else{\n                    console.log(\"white\", this.getFEN(), this.chameleons, sq);\n                    throw new Error(\"Cannot have more than 2 chameleons on one side in a position\");\n                }\n            }else{\n                if (this.chameleons[2] == 255)\n                    this.chameleons[2] = sq;\n                else if (this.chameleons[3] == 255)\n                    this.chameleons[3] = sq;\n                else{\n                    console.log(\"black\", this.getFEN(), this.chameleons, sq);\n                    throw new Error(\"Cannot have more than 2 chameleons on one side in a position\");\n                }\n            }\n        }else if (isPieceOfType(piece, PieceType.King)){\n            if (isWhite){\n                if (this.kings[0] != 255)\n                    throw new Error(\"Cannot have more than 1 king on one side in a position\");\n                this.kings[0] = sq;\n            }else{\n                if (this.kings[1] != 255)\n                    throw new Error(\"Cannot have more than 1 king on one side in a position\");\n                this.kings[1] = sq;\n            }\n        }\n    }\n\n    // returns any unique identifiers to a position (arrangement of pieces and whose turn it is)\n    public getPosition(): string {\n        return `${this.squares.join(\".\")}.${this.turn}`;\n    }\n\n    // returns true if the given pieceType is within a 1 square in any direction to the given sq\n    // AND if that piece is of opposite color to the given piece.\n    public inVicinity(sq: number, piece: Piece, pieceType: PieceType): boolean {\n        // go through all 8 directions\n        for (let i = 0; i < 8; i++){\n\n            // prevent wrapping around board\n            if (numSquaresToEdge[sq]![i] == 0)\n                continue;\n\n            const target = sq + dirOffsets[i]!;\n            const targetValue = this.getPiece(target);\n\n            if (isPieceOfType(targetValue, pieceType) && !arePiecesSameSide(piece, targetValue)){\n                return true;\n            }\n\n        }\n        return false;\n    }\n\n    // returns true if a given piece is within the sphere of influence of an enemy immobilizer.\n    public isImmobilized(sq: number, piece: Piece): boolean {\n        if (this.inVicinity(sq, piece, PieceType.Immobilizer))\n            return true;\n        if (isPieceOfType(piece, PieceType.Immobilizer))\n            return this.inVicinity(sq, piece, PieceType.Chameleon);\n        return false;\n    }\n\n    // retrieves the square of the king\n    public getKingSq(enemy: boolean): number {\n        return this.kings[this.turn == (enemy ? Side.Black : Side.White) ? 0 : 1]!;\n    }\n\n    // retrieves the square of the coordinator\n    public getCoordSq(enemy: boolean): number {\n        return this.coordinators[this.turn == (enemy ? Side.Black : Side.White) ? 0 : 1]!;\n    }\n\n    protected nextTurn(): void {\n        this.turn = this.turn == Side.White ? Side.Black : Side.White;\n    }\n    \n    // loads a FEN into this board state\n    public loadFEN(fen: string): void {\n        // clear board first\n        this.squares = new Uint8Array(64);\n        this.coordinators[0] = 255;\n        this.coordinators[1] = 255;\n        this.chameleons[0] = 255;\n        this.chameleons[1] = 255;\n        this.chameleons[2] = 255;\n        this.chameleons[3] = 255;\n        this.kings[0] = 255;\n        this.kings[1] = 255;\n        this.pieceCounts = [ [ 0, 0, 0, 0, 0, 0, 0, 0 ], [ 0, 0, 0, 0, 0, 0, 0, 0 ] ];\n\n        // 0 = board state\n        // 1 = turn\n        // 2 = fullmove number (number of fullmoves, starts at 1, incremented after black's move)\n        let segments = fen.split(\" \");\n\n        // rewrite board state\n        let state = segments[0]!;\n        let f = 0;\n        let r = 7;\n        for (let i = 0; i < state.length; i++){\n            let c = state[i]!;\n            \n            if (c == \"/\"){\n                r--;\n                f = 0;\n            }else if (getPieceFromFENChar(c)){\n                let piece = getPieceFromFENChar(c);\n                let sq = f + r * 8;\n                this.squares[sq] = piece;\n                f++;\n\n                const isWhite = isPieceOfSide(piece, Side.White);\n                this.pieceCounts[isWhite ? 0 : 1]![getPieceType(piece)]!++;\n\n                // if the piece is a king, record it\n                if (isPieceOfType(piece, PieceType.King)){\n                    isWhite ? this.kings[0] = sq : this.kings[1] = sq;\n                }\n\n                // if the piece is a coordinator, record it\n                if (isPieceOfType(piece, PieceType.Coordinator)){\n                    isWhite ? this.coordinators[0] = sq : this.coordinators[1] = sq;\n                }\n\n                if (isPieceOfType(piece, PieceType.Chameleon)){\n                    if (isWhite){\n                        if (this.chameleons[0] == 255){\n                            this.chameleons[0] = sq;\n                        }else{\n                            this.chameleons[1] = sq;\n                        }\n                    }else{\n                        if (this.chameleons[2] == 255){\n                            this.chameleons[2] = sq;\n                        }else{\n                            this.chameleons[3] = sq;\n                        }\n                    }\n                }\n            }else{\n                f += parseInt(c);\n            }\n        }\n\n        // set proper turn\n        if (segments[1]!.toLowerCase() == \"w\"){\n            this.turn = Side.White;\n        }else{\n            this.turn = Side.Black;\n        }\n\n        // halfmove clock\n        this.halfmoves = [ parseInt(segments[2]!) || 0 ];\n\n        // fullmove clock\n        this.fullmove = parseInt(segments[3]!);\n        if (isNaN(this.fullmove))\n            this.fullmove = 1;\n    }\n\n    public getFEN(): string {\n        let FEN = \"\";\n\n        // write board state into FEN\n        for (let r = 7; r >= 0; r--){\n            let empty = 0;\n            for (let f = 0; f < 8; f++){\n                let v = this.squares[f + r * 8];\n                if (v){\n                    if (empty)\n                        FEN += empty;\n                    empty = 0;\n\n                    let pieceFEN = getFENCharFromPieceType(getPieceType(v));\n                    FEN += isPieceOfSide(v, Side.White) ? pieceFEN.toUpperCase() : pieceFEN.toLowerCase();\n                }else{\n                    empty++;\n                }\n            }\n            if (empty)\n                FEN += empty;\n            FEN += \"/\";\n        }\n        FEN = FEN.substring(0, FEN.length - 1);\n\n        // set proper turn\n        let turn = this.turn == Side.White ? \"w\" : \"b\";\n\n        FEN += ` ${turn} ${this.halfmoves[0]} ${this.fullmove}`;\n\n        return FEN;\n    }\n}\n"]}