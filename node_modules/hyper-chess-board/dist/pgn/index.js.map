{"version":3,"file":"index.js","sourceRoot":"","sources":["../../pgn/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Board } from \"../game/board.js\";\nimport { Move } from \"../game/move.js\";\nimport { Side } from \"../game/piece.js\";\nimport type { PGNHeader, PGNHeaders } from \"../graphics/pgn/pgn-data.js\";\n\nexport function getResultTag(winner: Side): string {\n    if (winner == Side.None)\n        return \"1/2-1/2\";\n    else if (winner == Side.White)\n        return \"1-0\";\n    else if (winner == Side.Black)\n        return \"0-1\";\n    return \"*\";\n}\n\nexport function PGNHeadersToString(headers: PGNHeaders): string {\n    let pgn = \"\";\n    for (const [ name, value ] of Object.entries(headers))\n        pgn += `[${name} \"${value}\"]\\n`;\n    return pgn;\n}\n\n// splits the given string into each individual game.\n// returns an array of the individual games.\nexport function splitPGNs(pgnsString: string): string[] {\n    const games = [];\n\n    // the first capture group catches all of the PGN headers. The next capture group handles\n    // capturing comments, move numbers, and SANs. The very last capture group searches for the\n    // game termination marker (required for each PGN).\n    const pgnRegex = /(?:\\[[^\\]^\\[]*\\]\\s*)*(?:{[^{^}]*}\\s*|\\d+\\.+|\\([^{^}]*\\s+\\)|[A-Za-z0-9\\+\\#]+|\\s+)*(?:\\*|1-0|0-1|1\\/2-1\\/2)/g;\n\n    for (const [ pgn ] of pgnsString.matchAll(pgnRegex))\n        games.push(pgn.trim());\n\n    return games;\n}\n\n// takes in a list of moves\nexport function convertToPGN(headers: PGNHeaders, moves: Move[], board: Board, resultTag = \"*\"): string {\n    let pgn = `${PGNHeadersToString(headers)}\\n`;\n\n    // play out each move\n    let counter = board.getFullMove();\n    if (board.getTurn() == Side.Black)\n        pgn += `${counter++}... `;\n    for (const move of moves){\n        const san = board.getMoveSAN(move);\n        board.makeMove(move);\n\n        if (board.getTurn() == Side.Black){\n            pgn += `${counter++}. ${san} `;\n        }else{\n            pgn += `${san} `;\n        }\n    }\n\n    pgn += resultTag;\n    return pgn.trim();\n}\n\n// returns a dictionary where keys are header names and values are header values.\nexport function extractHeaders(pgn: string): PGNHeaders {\n    const headers: PGNHeaders = {};\n\n    let leftBracket = pgn.indexOf(\"[\");\n    while (leftBracket > -1){\n        let rightBracket = pgn.indexOf(\"]\");\n        const field = pgn.substring(leftBracket, rightBracket + 1);\n\n        let leftQuote = field.indexOf(\"\\\"\") + leftBracket;\n        let rightQuote = field.indexOf(\"\\\"\", leftQuote + 1) + leftBracket;\n\n        if (leftQuote > -1 && rightQuote > -1){\n            let value = pgn.substring(leftQuote + 1, rightQuote).trim();\n            let name = pgn.substring(leftBracket + 1, leftQuote).trim() as PGNHeader;\n            headers[name] = value;\n        }\n\n        // remove header now that we've extracted it\n        pgn = pgn.substring(rightBracket + 1);\n\n        leftBracket = pgn.indexOf(\"[\");\n    }\n\n    return headers;\n}\n\nexport function extractMoves(pgn: string): string {\n    // remove headers\n    pgn = pgn.replace(/\\[.+?\\]\\s*/g, \"\");\n\n    // remove any comments\n    pgn = pgn.replace(/\\{.+?\\}\\s*/g, \"\");\n\n    // remove full move counters\n    pgn = pgn.replace(/[0-9]+[\\.]+/g, \"\");\n\n    // add a space before and after parentheses\n    pgn = pgn.replace(/\\(/g, \" ( \").replace(/\\)/g, \" ) \");\n\n    // make sure there is one space between each move\n    pgn = pgn.replace(/\\s+/g, \" \");\n    pgn = pgn.trim();\n\n    return pgn;\n}\n\n// returns the current date in the form YYYY.MM.DD\nexport function getPGNDateNow(): string {\n    const date = new Date();\n    const y = date.getFullYear().toString().padStart(4, \"0\");\n    const m = (date.getMonth() + 1).toString().padStart(2, \"0\");\n    const d = (date.getDay() + 1).toString().padStart(2, \"0\");\n\n    return `${y}.${m}.${d}`;\n}\n"]}